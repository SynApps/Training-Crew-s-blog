<% content_for :title do %><%= @post.title %><% end %> 
<% content_for :head do %>
  <script type="text/javascript" src="http://gettopup.com/releases/latest/top_up-min.js"></script> 
  <script type="text/javascript">
    function close_comment_form(){
      TopUp.close();
      var t=setTimeout("window.location.reload(true);",1500);
    }
  </script>
<% end %>
<div class="post details">
  <h1><%= @post.title %></h1>
  <div><%= @post.body %></div>
  <span class="date"><%= @post.published_at %></span>
  <div class="replymain">
    <%= link_to "Répondre", new_comment_path({:slug => @post.slug }), :toptions =>"width = 800, height = 400, type = iframe, title = Nouveau commentaire, layout = dashboard" %>
  </div>
</div>
<% if @post.comments.size > 0 %>
<hr /> 
<% end %>
<div class="comments">
  <ul>
  <% for c in @post.comments.select{|c| c.is_root?} %>
      <li>
        <div class="header">
          <div class="username"><%= c.user %></div>
          <div class="reply">
            <%= link_to "Répondre", { :controller => 'comment', :action => 'reply', :id => c.id }, 
              :toptions =>"width = 800, height = 450, type = iframe, title = Nouveau commentaire, layout = dashboard" %>
          </div>
          <div class="date"><%= c.since %></div>
          <br class="clear" />
        </div>
        <div class="comment"><%= c.text %></div>
        <% unless c.replies.empty? %>
        <div class="replies">
          <ul>
            <% c.replies.each do |r| %>
              <li>
                <div class="header">
                  <div class="username"><%= r.user %></div>
                  <div class="date"><%= r.since  %></div>
                  <br class="clear" />
                </div>
                <div class="comment"><%= r.text %></div>
              </li>
            <% end %>
          </ul> 
        </div>
      <% end %>
      </li>
  <%end%>
  </ul>
</div>


